# This is a template for docker-compose.yml.
# Do not edit this file with scripts. Edit manually to change service definitions or port placeholders.
# Ports are filled in by scripts/generate_compose.py using values from ports.json.
# To change host ports, edit ports.json. To add/remove services, edit this template and ports.json.
#
# After editing, run: python scripts/manage_stack.py
#
# For more info, see README.md.

networks:
  azure_stack_network:
    driver: bridge
services:
  mongodb-as-cosmosdb:
    container_name: mongodb_as_cosmosdb
    image: mongo:latest
    ports:
    - {{MONGODB_AS_COSMOSDB_PORT}}
  cosmosdb:
    container_name: azure_cosmosdb_emulator
    environment:
      AZURE_COSMOS_EMULATOR_ENABLE_DATA_PERSISTENCE: 'true'
      AZURE_COSMOS_EMULATOR_PARTITION_COUNT: 10
    image: mcr.microsoft.com/cosmosdb/linux/azure-cosmos-emulator:latest
    ports:
    - {{COSMOSDB_PORT_1}}
    - {{COSMOSDB_PORT_2}}
    - {{COSMOSDB_PORT_3}}
    - {{COSMOSDB_PORT_4}}
    - {{COSMOSDB_PORT_5}}
    - {{COSMOSDB_PORT_6}}
  azurite:
    container_name: azure_storage_emulator
    environment:
      AZURITE_ACCOUNTS: ${STORAGE_ACCOUNT_NAME}:${STORAGE_ACCOUNT_KEY}
    image: mcr.microsoft.com/azure-storage/azurite:latest
    logging:
      driver: json-file
      options:
        max-file: '3'
        max-size: 10m
    ports:
    - {{STORAGE_PORT_1}}
    - {{STORAGE_PORT_2}}
    - {{STORAGE_PORT_3}}
    volumes:
    - azurite_data:/data
volumes:
  azurite_data: null